'use strict';

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _postcssSelectorParser = require('postcss-selector-parser');

var _postcssSelectorParser2 = _interopRequireDefault(_postcssSelectorParser);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = _postcss2.default.plugin('postcss-dialog-polyfill', function () {
  return function (css) {
    css.walkRules(function (rule) {
      (0, _postcssSelectorParser2.default)(function (selectors) {
        selectors.walkPseudos(function (pseudo) {
          if (pseudo.value === '::backdrop') {
            if (!new RegExp('.*' + pseudo.parent.first.toString().trim() + ' \\+ \\.backdrop.*').test(rule.selector)) {
              rule.selector += ', ' + pseudo.parent.first.toString().trim() + ' + .backdrop';
            }
          }
        });
      }).process(rule.selector);
    });
  };
});